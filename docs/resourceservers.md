# OAuth for Resource Servers

This document describes how you can implement *Resource Servers* which are
protected by OAuth 2.0 using *access tokens* generated by **Mimir**.

**Mimir** generates self-encoded *access tokens*, which means that the token
contains all the information required to authenticate and authorize the request.

An *access token* is a [JWT] token signed by **Mimir** which contains the following
claims:

Claim | Type | Description
--- | --- | ---
sub | *string* | Identifier of the user that the request is being made on behalf of (may be a `username` or a `client_id`).
aud | *string* | When the request is made on behalf of an end-user, this field contains the `client_id` of the client acting on behalf of the end-user.
scope | *string[]* | Set of scopes that the end-user has granted consent to the client.

## Step 1: Authentication

Resource Servers **MUST** implement authentication using `Bearer` token. The token passed in the header
is the *access token*.

```http
Authorization: Bearer [ACCESS_TOKEN]
```

The *access token* [JWT] must be decoded and validated. There're two main validations required:

- **Validate the signature**: token's signature must be validated in order to guarantee that the token contents
have not been manipulated since the token creation in **Mimir**.
- **Check token expiration**: expired tokens must never be accepted. Expiration time is sent in the `exp` claim.

In order to validate the token's signature, the key used by the server to sign the token is needed. **Mimir** supports
[JWK] (JSON Web Keys) so it exposes its public key in the API so clients can validate the signature.

```http
GET https://[MIMIR_API]/.well-known/jwks.json
```

[JWT] client libraries usually supports [JWK].

## Step 2: Authorization

Once the *access token* has been decoded, the *Resource Server* **MUST** validate if the scope required for the
accessed resource is granted in the token (`scope`) and if the identity (`sub`) has access to that resource.

## Further reading

- <https://www.oauth.com/oauth2-servers/the-resource-server/>

[JWT]: https://tools.ietf.org/html/rfc7519
[JWK]: https://tools.ietf.org/html/rfc7517
